<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rhetorical Appeals Highlighter (Hover Version)</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        line-height: 1.6;
    }
    .toolbar {
        margin-bottom: 15px;
    }
    button {
        padding: 8px 14px;
        margin: 4px;
        border: none;
        cursor: pointer;
        border-radius: 4px;
        font-weight: bold;
    }

    /* Colors */
    .Logos { background-color: #a3d5ff; }
    .Pathos { background-color: #ffb3c6; }
    .Ethos { background-color: #c3f7c3; }
    .Kairos { background-color: #ffe7a1; }

    .eraser { background-color: #e0e0e0; }
    .undo { background-color: #d4c4ff; }
    .reset { background-color: #ffcccc; }
    .save { background-color: #c2ffd2; }

    #textBox {
        border: 1px solid #ccc;
        padding: 15px;
        min-height: 200px;
        white-space: pre-wrap;
    }

    mark {
        padding: 2px;
        border-radius: 3px;
    }
</style>
</head>

<body>

<h2>Rhetorical Appeals Highlighter (Hover Version)</h2>

<div class="toolbar">
    <button class="Logos" title="Logos: logical appeal using facts, reasoning, or evidence" onclick="setMode('Logos')">Logos</button>
    <button class="Pathos" title="Pathos: emotional appeal that evokes feelings" onclick="setMode('Pathos')">Pathos</button>
    <button class="Ethos" title="Ethos: ethical appeal based on credibility or character" onclick="setMode('Ethos')">Ethos</button>
    <button class="Kairos" title="Kairos: appeal to timeliness or the opportune moment" onclick="setMode('Kairos')">Kairos</button>

    <button class="eraser" title="Remove highlighting" onclick="setMode('erase')">Eraser</button>
    <button class="undo" onclick="undo()">Undo</button>
    <button class="reset" onclick="resetHighlights()">Reset</button>
    <button class="save" onclick="saveWork()">Save</button>
</div>

<div id="textBox" contenteditable="true">
    Tell General Howard I know his heart. What he told me before, I have in my heart. I am tired of fighting. Our chiefs are killed. Looking Glass is dead. Toohoolhoolzote is dead. The old men are all dead. It is the young men who say yes and no. He who led on the young men is dead. It is cold and we have no blankets. The little children are freezing to death. My people, some of them, have run away to the hills and have no blankets, no food; no one knows where they areâ€”perhaps freezing to death. I want to have time to look for my children and see how many I can find. Maybe I shall find them among the dead. Hear me, my chiefs. I am tired; my heart is sick and sad. From where the sun now stands I will fight no more forever.
</div>

<script>
let mode = null;
let historyStack = [];

function saveState() {
    historyStack.push(document.getElementById("textBox").innerHTML);
}

function setMode(newMode) {
    mode = newMode;
}

document.getElementById("textBox").addEventListener("mouseup", function () {
    let selection = window.getSelection();
    if (selection.toString().length === 0 || !mode) return;

    saveState();

    let range = selection.getRangeAt(0);

    if (mode === "erase") {
        // Remove any <mark> tags inside the selection
        let contents = range.extractContents();
        let walker = document.createTreeWalker(contents, NodeFilter.SHOW_ELEMENT);

        let node;
        while (node = walker.nextNode()) {
            if (node.tagName === "MARK") {
                let parent = node.parentNode;
                while (node.firstChild) {
                    parent.insertBefore(node.firstChild, node);
                }
                parent.removeChild(node);
            }
        }

        range.insertNode(contents);
        selection.removeAllRanges();
        return;
    }

    // Normal highlighting
    let span = document.createElement("mark");
    span.className = mode;
    span.appendChild(range.extractContents());
    range.insertNode(span);

    selection.removeAllRanges();
});

function undo() {
    if (historyStack.length > 0) {
        document.getElementById("textBox").innerHTML = historyStack.pop();
    }
}

function resetHighlights() {
    saveState();
    let box = document.getElementById("textBox");
    box.innerHTML = box.innerText;
}

function saveWork() {
    let content = document.getElementById("textBox").innerHTML;
    let blob = new Blob([content], { type: "text/html" });
    let url = URL.createObjectURL(blob);

    let a = document.createElement("a");
    a.href = url;
    a.download = "rhetorical_highlights.html";
    a.click();

    URL.revokeObjectURL(url);
}
</script>

</body>

</html>

